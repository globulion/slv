Effective Fragment Potentials
=============================

Bartosz BÅ‚asiak, May 5, 2017  Updated: 

INTRODUCTION
------------

In the following sections we show how to use EFP2 and SolEFP methods within Solvshift.
First, the *fragment parameter file format* (FRG) inherently used within SLV is explained.
Second, the generation of custom FRG files, both for solvent (EFP2), as well a solute 
(SolEFP), is outlined. Finally, SolEFP calculations are demonstrated on simple examples.

FRG FILE FORMAT
---------------

Fragment parameter file format is a Solvshift utility to manage large and extensive
quantum chemistry information on the benchmark solute/solvent molecule (BSM):

 * Atomic symbols, masses and structure
 * Basis set 
 * Distributed multipole moments 
 * Localized molecular orbital centroids
 * Distributed polarizabilities
 * Wave function and Fock matrix
 * Vibrational analysis (frequencies, eigenvectors, reduced masses and cubic anharmonic constants)
 * First and second derivatives of multipoles, polarizabilities, wave function and Fock matrix
   with respect to normal coordinates of solute.

Solvshift
has an internal library of BSM's which are stored under `solvshift/dat` directory.

> WARNING: User should never change the contents of FRG file except adding comments after `!` sign.
> Changes in numerical values will result in errors in calculations and unphysical results!

To get a detailed information on the FRG file format, refer to the documentation of class `Frag`.
```python
from solvshift.slvpar import Frag
help(Frag)
```
As one can see, class `Frag` handles FRG objects and can be easily accessed from Python level.
FRG file can be read in a following way:
```python
frg1 = Frag('water')
frg2 = Frag('/path/to/custom/fragment/bsm.frg')
```
In the first case we read fragment from SLV library by simply invoking a name of a molecule.
The corresponding file is located at `$SLV_DATA/frg` directory. Note that the actual path and postfix 
`.frg` have been ommited here. If we want to use custom fragment that we had not
added to SLV library (second case), we need to specify the entire path to the file of interest.

PREPARING CUSTOM FRG FILES
--------------------------

Preparation of FRG files is automatized by the tools `slv_make-frg` (designed for solvent files)
and `slv_solefp-frg` (solute files). In each case, a series of calculations by using the Gaussian
and GAMESS US programs are necessary before SLV tools can be used. During these initial calculations, 
structures should be energy-optimized in Gaussian and EFP file(s) generated by GAMESS. In the case
of solute, a series of EFP files and formatted checkpoint files (FCHK) need to be obtained. After
these initial calculations, Solvshift calculates all the parameters and stores them in FRG output file.

### Solvent FRG files.

The following command needs to be run in order to create solvent FRG file.
```
slv_make-frg [fchk] [camm] None [Gamess efp] [output file] [nae] <basis>
```
So far, HF/6-311++G** 6D method was tested and is recommended. 

> The keyword `None` will be deprecated in the future. Originally, GAMESS output file was necessary
> to read Fock matrix. However, later changes in the code enabled Fock matrices to be computed by Solvshift and 
> GAMESS log files are no longer necessary. 

#### Generation of FCHK file.

FCHK file can be obtained from Gaussian CHK files by using `formchk` utility provided by Gaussian.
The input for the generation of CHK file is here provided as an example:
```
%chk=water.chk
%mem=1000mb
%nprocshared=4

#P RHF/6-311++G** 6D scf(conver=11,xqc,novaracc) nosymm

CHK file for water

0 1
O    0.000000    0.113009    0.000000
H    0.752785   -0.452035    0.000000
H   -0.752785   -0.452035    0.000000

```
> WARNING: The keywords `6D` and `nosymm` are absolutely crucial here and cannot be omitted. 
> Otherwise, the results will be totally wrong.

#### Generation of CAMM file.

CAMM file contains the distributed multipole analysis that needs to be computed by Solvshift.
To create CAMM file, FCHK file needs to be created first.

#### Generation of EFP file.

#### Generation of FRG file from FCHK, CAMM and EFP file.

For water molecule example, the command that needs to be run is as follows:
```
slv_make-frg water.fchk water.camm None water.efp water.frg 5 6-311++G**
```
The output `water.frg` is the final BSM file for solvent.


### Solute FRG files.


